#!/usr/bin/env python3
"""
Sprite improvement tool - adds proper outlines and shading per style guide
"""
from PIL import Image
import os

# Style guide colors
OUTLINE = (0x40, 0x40, 0x40, 0xFF)  # #404040

# Foliage colors
FOLIAGE_HIGHLIGHT = (0x88, 0xCC, 0x50)
FOLIAGE_BASE = (0x64, 0xA8, 0x38)
FOLIAGE_SHADOW = (0x4C, 0x78, 0x28)

# Wood colors
WOOD_HIGHLIGHT = (0xC4, 0xA4, 0x84)
WOOD_BASE = (0xA0, 0x84, 0x6C)
WOOD_SHADOW = (0x7C, 0x64, 0x50)

# Stone colors
STONE_HIGHLIGHT = (0xA8, 0xA8, 0xA8)
STONE_BASE = (0x88, 0x88, 0x88)
STONE_SHADOW = (0x60, 0x60, 0x60)

def create_tree_production():
    """Create a production-quality tree with outline and shading"""
    img = Image.new('RGBA', (32, 32), (0, 0, 0, 0))
    pixels = img.load()
    
    # Tree foliage shape (circular-ish top)
    foliage_pixels = [
        # Row 1 (top)
        (10, 2), (11, 2), (12, 2), (13, 2), (14, 2), (15, 2), (16, 2), (17, 2), (18, 2), (19, 2), (20, 2), (21, 2),
        # Row 2
        (8, 3), (9, 3), (10, 3), (11, 3), (12, 3), (13, 3), (14, 3), (15, 3), (16, 3), (17, 3), (18, 3), (19, 3), (20, 3), (21, 3), (22, 3), (23, 3),
        # Row 3
        (6, 4), (7, 4), (8, 4), (9, 4), (10, 4), (11, 4), (12, 4), (13, 4), (14, 4), (15, 4), (16, 4), (17, 4), (18, 4), (19, 4), (20, 4), (21, 4), (22, 4), (23, 4), (24, 4), (25, 4),
        # Row 4
        (5, 5), (6, 5), (7, 5), (8, 5), (9, 5), (10, 5), (11, 5), (12, 5), (13, 5), (14, 5), (15, 5), (16, 5), (17, 5), (18, 5), (19, 5), (20, 5), (21, 5), (22, 5), (23, 5), (24, 5), (25, 5), (26, 5),
        # Row 5-8 (full width)
        (4, 6), (5, 6), (6, 6), (7, 6), (8, 6), (9, 6), (10, 6), (11, 6), (12, 6), (13, 6), (14, 6), (15, 6), (16, 6), (17, 6), (18, 6), (19, 6), (20, 6), (21, 6), (22, 6), (23, 6), (24, 6), (25, 6), (26, 6), (27, 6),
        (4, 7), (5, 7), (6, 7), (7, 7), (8, 7), (9, 7), (10, 7), (11, 7), (12, 7), (13, 7), (14, 7), (15, 7), (16, 7), (17, 7), (18, 7), (19, 7), (20, 7), (21, 7), (22, 7), (23, 7), (24, 7), (25, 7), (26, 7), (27, 7),
        (4, 8), (5, 8), (6, 8), (7, 8), (8, 8), (9, 8), (10, 8), (11, 8), (12, 8), (13, 8), (14, 8), (15, 8), (16, 8), (17, 8), (18, 8), (19, 8), (20, 8), (21, 8), (22, 8), (23, 8), (24, 8), (25, 8), (26, 8), (27, 8),
        (5, 9), (6, 9), (7, 9), (8, 9), (9, 9), (10, 9), (11, 9), (12, 9), (13, 9), (14, 9), (15, 9), (16, 9), (17, 9), (18, 9), (19, 9), (20, 9), (21, 9), (22, 9), (23, 9), (24, 9), (25, 9), (26, 9),
        # Bottom taper
        (6, 10), (7, 10), (8, 10), (9, 10), (10, 10), (11, 10), (12, 10), (13, 10), (14, 10), (15, 10), (16, 10), (17, 10), (18, 10), (19, 10), (20, 10), (21, 10), (22, 10), (23, 10), (24, 10), (25, 10),
        (8, 11), (9, 11), (10, 11), (11, 11), (12, 11), (13, 11), (14, 11), (15, 11), (16, 11), (17, 11), (18, 11), (19, 11), (20, 11), (21, 11), (22, 11), (23, 11),
    ]
    
    # Draw foliage with shading (light from top-left)
    for x, y in foliage_pixels:
        # Determine shade based on position (top-left = highlight, bottom-right = shadow)
        is_highlight = x < 12 and y < 6
        is_shadow = x > 18 or y > 8
        
        if is_highlight:
            pixels[x, y] = FOLIAGE_HIGHLIGHT + (0xFF,)
        elif is_shadow:
            pixels[x, y] = FOLIAGE_SHADOW + (0xFF,)
        else:
            pixels[x, y] = FOLIAGE_BASE + (0xFF,)
    
    # Tree trunk
    trunk_pixels = [
        (13, 12), (14, 12), (15, 12), (16, 12), (17, 12), (18, 12),
        (12, 13), (13, 13), (14, 13), (15, 13), (16, 13), (17, 13), (18, 13), (19, 13),
        (12, 14), (13, 14), (14, 14), (15, 14), (16, 14), (17, 14), (18, 14), (19, 14),
        (12, 15), (13, 15), (14, 15), (15, 15), (16, 15), (17, 15), (18, 15), (19, 15),
        (13, 16), (14, 16), (15, 16), (16, 16), (17, 16), (18, 16),
        (13, 17), (14, 17), (15, 17), (16, 17), (17, 17), (18, 17),
        (14, 18), (15, 18), (16, 18), (17, 18),
        (14, 19), (15, 19), (16, 19), (17, 19),
        (15, 20), (16, 20),
        (15, 21), (16, 21),
        (15, 22), (16, 22),
        (15, 23), (16, 23),
        (15, 24), (16, 24),
        (15, 25), (16, 25),
        (14, 26), (15, 26), (16, 26), (17, 26),
        (13, 27), (14, 27), (15, 27), (16, 27), (17, 27), (18, 27),
        (12, 28), (13, 28), (14, 28), (15, 28), (16, 28), (17, 28), (18, 28), (19, 28),
        (12, 29), (13, 29), (14, 29), (15, 29), (16, 29), (17, 29), (18, 29), (19, 29),
        (11, 30), (12, 30), (13, 30), (14, 30), (15, 30), (16, 30), (17, 30), (18, 30), (19, 30), (20, 30),
        (10, 31), (11, 31), (12, 31), (13, 31), (14, 31), (15, 31), (16, 31), (17, 31), (18, 31), (19, 31), (20, 31), (21, 31),
    ]
    
    # Draw trunk with shading
    for x, y in trunk_pixels:
        is_highlight = x < 14
        is_shadow = x > 17
        
        if is_highlight:
            pixels[x, y] = WOOD_HIGHLIGHT + (0xFF,)
        elif is_shadow:
            pixels[x, y] = WOOD_SHADOW + (0xFF,)
        else:
            pixels[x, y] = WOOD_BASE + (0xFF,)
    
    # Add 1px outline
    img = add_outline(img)
    
    return img

def create_rock_production():
    """Create a production-quality rock with outline and shading"""
    img = Image.new('RGBA', (32, 32), (0, 0, 0, 0))
    pixels = img.load()
    
    # Rock shape (irregular boulder)
    rock_pixels = [
        # Row 2
        (10, 2), (11, 2), (12, 2), (13, 2), (14, 2), (15, 2), (16, 2), (17, 2), (18, 2), (19, 2), (20, 2),
        # Row 3
        (8, 3), (9, 3), (10, 3), (11, 3), (12, 3), (13, 3), (14, 3), (15, 3), (16, 3), (17, 3), (18, 3), (19, 3), (20, 3), (21, 3), (22, 3), (23, 3),
        # Row 4
        (6, 4), (7, 4), (8, 4), (9, 4), (10, 4), (11, 4), (12, 4), (13, 4), (14, 4), (15, 4), (16, 4), (17, 4), (18, 4), (19, 4), (20, 4), (21, 4), (22, 4), (23, 4), (24, 4), (25, 4),
        # Row 5
        (5, 5), (6, 5), (7, 5), (8, 5), (9, 5), (10, 5), (11, 5), (12, 5), (13, 5), (14, 5), (15, 5), (16, 5), (17, 5), (18, 5), (19, 5), (20, 5), (21, 5), (22, 5), (23, 5), (24, 5), (25, 5), (26, 5),
        # Row 6-8 (full)
        (4, 6), (5, 6), (6, 6), (7, 6), (8, 6), (9, 6), (10, 6), (11, 6), (12, 6), (13, 6), (14, 6), (15, 6), (16, 6), (17, 6), (18, 6), (19, 6), (20, 6), (21, 6), (22, 6), (23, 6), (24, 6), (25, 6), (26, 6), (27, 6),
        (4, 7), (5, 7), (6, 7), (7, 7), (8, 7), (9, 7), (10, 7), (11, 7), (12, 7), (13, 7), (14, 7), (15, 7), (16, 7), (17, 7), (18, 7), (19, 7), (20, 7), (21, 7), (22, 7), (23, 7), (24, 7), (25, 7), (26, 7), (27, 7),
        (3, 8), (4, 8), (5, 8), (6, 8), (7, 8), (8, 8), (9, 8), (10, 8), (11, 8), (12, 8), (13, 8), (14, 8), (15, 8), (16, 8), (17, 8), (18, 8), (19, 8), (20, 8), (21, 8), (22, 8), (23, 8), (24, 8), (25, 8), (26, 8), (27, 8), (28, 8),
        # Row 9-12
        (3, 9), (4, 9), (5, 9), (6, 9), (7, 9), (8, 9), (9, 9), (10, 9), (11, 9), (12, 9), (13, 9), (14, 9), (15, 9), (16, 9), (17, 9), (18, 9), (19, 9), (20, 9), (21, 9), (22, 9), (23, 9), (24, 9), (25, 9), (26, 9), (27, 9), (28, 9),
        (2, 10), (3, 10), (4, 10), (5, 10), (6, 10), (7, 10), (8, 10), (9, 10), (10, 10), (11, 10), (12, 10), (13, 10), (14, 10), (15, 10), (16, 10), (17, 10), (18, 10), (19, 10), (20, 10), (21, 10), (22, 10), (23, 10), (24, 10), (25, 10), (26, 10), (27, 10), (28, 10), (29, 10),
        (2, 11), (3, 11), (4, 11), (5, 11), (6, 11), (7, 11), (8, 11), (9, 11), (10, 11), (11, 11), (12, 11), (13, 11), (14, 11), (15, 11), (16, 11), (17, 11), (18, 11), (19, 11), (20, 11), (21, 11), (22, 11), (23, 11), (24, 11), (25, 11), (26, 11), (27, 11), (28, 11), (29, 11),
        # Row 13-16 (bottom taper)
        (3, 12), (4, 12), (5, 12), (6, 12), (7, 12), (8, 12), (9, 12), (10, 12), (11, 12), (12, 12), (13, 12), (14, 12), (15, 12), (16, 12), (17, 12), (18, 12), (19, 12), (20, 12), (21, 12), (22, 12), (23, 12), (24, 12), (25, 12), (26, 12), (27, 12), (28, 12),
        (4, 13), (5, 13), (6, 13), (7, 13), (8, 13), (9, 13), (10, 13), (11, 13), (12, 13), (13, 13), (14, 13), (15, 13), (16, 13), (17, 13), (18, 13), (19, 13), (20, 13), (21, 13), (22, 13), (23, 13), (24, 13), (25, 13), (26, 13), (27, 13),
        (5, 14), (6, 14), (7, 14), (8, 14), (9, 14), (10, 14), (11, 14), (12, 14), (13, 14), (14, 14), (15, 14), (16, 14), (17, 14), (18, 14), (19, 14), (20, 14), (21, 14), (22, 14), (23, 14), (24, 14), (25, 14), (26, 14),
        (6, 15), (7, 15), (8, 15), (9, 15), (10, 15), (11, 15), (12, 15), (13, 15), (14, 15), (15, 15), (16, 15), (17, 15), (18, 15), (19, 15), (20, 15), (21, 15), (22, 15), (23, 15), (24, 15), (25, 15),
        (7, 16), (8, 16), (9, 16), (10, 16), (11, 16), (12, 16), (13, 16), (14, 16), (15, 16), (16, 16), (17, 16), (18, 16), (19, 16), (20, 16), (21, 16), (22, 16), (23, 16), (24, 16),
        (8, 17), (9, 17), (10, 17), (11, 17), (12, 17), (13, 17), (14, 17), (15, 17), (16, 17), (17, 17), (18, 17), (19, 17), (20, 17), (21, 17), (22, 17), (23, 17),
        (9, 18), (10, 18), (11, 18), (12, 18), (13, 18), (14, 18), (15, 18), (16, 18), (17, 18), (18, 18), (19, 18), (20, 18), (21, 18), (22, 18),
        (10, 19), (11, 19), (12, 19), (13, 19), (14, 19), (15, 19), (16, 19), (17, 19), (18, 19), (19, 19), (20, 19), (21, 19),
        (11, 20), (12, 20), (13, 20), (14, 20), (15, 20), (16, 20), (17, 20), (18, 20), (19, 20), (20, 20),
        (12, 21), (13, 21), (14, 21), (15, 21), (16, 21), (17, 21), (18, 21), (19, 21),
        (13, 22), (14, 22), (15, 22), (16, 22), (17, 22), (18, 22),
    ]
    
    # Draw rock with shading (light from top-left)
    for x, y in rock_pixels:
        # Create some texture variation
        is_highlight = x < 10 and y < 8
        is_shadow = x > 20 or y > 14
        
        if is_highlight:
            pixels[x, y] = STONE_HIGHLIGHT + (0xFF,)
        elif is_shadow:
            pixels[x, y] = STONE_SHADOW + (0xFF,)
        else:
            pixels[x, y] = STONE_BASE + (0xFF,)
    
    # Add 1px outline
    img = add_outline(img)
    
    return img

def add_outline(img):
    """Add 1px #404040 outline to all non-transparent pixels"""
    width, height = img.size
    pixels = img.load()
    
    # Find all opaque pixels
    opaque = set()
    for y in range(height):
        for x in range(width):
            if pixels[x, y][3] > 0:  # Alpha > 0
                opaque.add((x, y))
    
    # Add outline around opaque pixels
    outline_pixels = set()
    for x, y in opaque:
        for dx in [-1, 0, 1]:
            for dy in [-1, 0, 1]:
                if dx == 0 and dy == 0:
                    continue
                nx, ny = x + dx, y + dy
                if 0 <= nx < width and 0 <= ny < height:
                    if (nx, ny) not in opaque:
                        outline_pixels.add((nx, ny))
    
    # Draw outline
    for x, y in outline_pixels:
        pixels[x, y] = OUTLINE
    
    return img

def main():
    """Generate production-quality sprites"""
    output_dir = "assets/sprites/placeholders"
    
    print("Generating production-quality tree...")
    tree = create_tree_production()
    tree.save(os.path.join(output_dir, "tree.png"))
    print(f"  Saved: tree.png ({tree.size[0]}x{tree.size[1]})")
    
    print("Generating production-quality rock...")
    rock = create_rock_production()
    rock.save(os.path.join(output_dir, "rock.png"))
    print(f"  Saved: rock.png ({rock.size[0]}x{rock.size[1]})")
    
    print("\nDone! Sprites improved with:")
    print("  - 1px #404040 outline per style guide")
    print("  - 2-3 shade cell shading")
    print("  - Transparent backgrounds")

if __name__ == "__main__":
    main()
